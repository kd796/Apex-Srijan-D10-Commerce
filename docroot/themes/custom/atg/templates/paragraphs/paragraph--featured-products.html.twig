{# @todo need figure out way to get pure values instead of all the additional keys, hence the #id conditional #}
{% set featured_products = [] %}
{% for key,product in content.field_featured_products_list  %}
     {% if product['#options']['entity'] is defined %}
        {% set featured_products = featured_products|merge([product['#options']['entity']]) %}
    {% endif %}
{% endfor %}

{% if featured_products is not empty %}
    <section class="section main">
    	<header class="section-header">
    		<h2 class="section-title">{{ content.field_title[0]['#context']['value'] | raw }}</h2>
    	</header>
        <div class="section-main">
            <ul class="listings">
              {% set locale  = get_locale() %}
              {% set alias   = alias_by_path('/products/product-catalog', locale.code) %}
              {% set baseUrl = locale.path ~ alias ~ '/' %}

              {% for index, item in featured_products %}

                {% set name = item.field_long_description.value %}
                {% if not name %}
                  {% set name = item.title.value %}
                {% endif %}

                {% set body = item.field_features_copy.value %}
                {% if not body %}
                  {% set body = item.body.value %}
                {% endif %}
                {# Hide body for now as its not used currently #}
                {% set body = null %}

                {% set url  = baseUrl ~ item.field_slug.value %}

                {% set img = item.field_360_image.0.entity.field_360_loading_image|file_url|image_style('product_thumb') %}
                {% if not img %}
                  {% set img = item.field_media|file_url|image_style('product_thumb') %}
                {% endif %}

    				<li class="listings-item">
    					{% include '@atg/patterns/listing.html.twig' with {
    						url: locale.path ~ url,
    						title: name,
    						body: body,
                image: img,
    					} %}
    				</li>
                {% endfor %}
			</ul>
        </div>
    </section>
{% endif %}
