# Migration configuration for gearwrench_products content.
id: gearwrench_products
label: Products
migration_group: gearwrench
source:
  constants:
    bool_0: 0
    bool_1: 1
    uid_root: 1
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: xml
  urls: 'public://import/pim_data/test-pim.xml'
  namespaces:
    stibo: "http://www.stibosystems.com/step"
  item_selector: /STEP-ProductInformation/Products/Product/Product
  fields:
    - name: remote_sku
      label: SKU
      selector: '@ID'
    - name: remote_name
      label: SKU Group
      selector: stibo:Name
    - name: remote_sku_group
      label: SKU Group
      selector: ../../Product
    - name: remote_product_specifications
      label: Product Specifications
      selector: stibo:Values
    - name: remote_product_features
      label: Product Features
      selector: ../Values
    - name: remote_product_classifications
      label: Product Classifications
      selector: ../../Product
    - name: remote_product_upc
      label: Product UPC
      selector: Values/Value[@AttributeID="ATT539"]
  ids:
    remote_sku:
      type: string
process:
  type:
    plugin: default_value
    default_value: product
  title: remote_name
  sticky: constants/bool_0
  promote: constants/bool_1
  uid: constants/uid_root
  field_sku: remote_sku
  field_sku_group:
    -
      plugin: get_id_attribute
      source: remote_sku_group
    -
      plugin: create_unique_term
      vocabulary: sku_groups
    -
      plugin: skip_on_empty
      method: row
  product_specifications_array:
    plugin: get_values_array
    source: remote_product_specifications
  field_product_specifications:
    plugin: sub_process
    source: '@product_specifications_array'
    include_source: true
    process:
      vocabulary_id:
        - plugin: skip_on_empty
          method: process
          source: vid
      target_id:
        -
          plugin: entity_generate
          source: term_name
          entity_type: taxonomy_term
          bundle_key: vid
          bundle: '@vocabulary_id'
          value_key: name
          ignore_case: true
        -
          plugin: skip_on_empty
          method: process
  product_features_array:
    plugin: get_product_features_array
    source: remote_product_features
  field_product_features:
    plugin: sub_process
    source: '@product_features_array'
    include_source: true
    process:
      value: copy_point
  product_classifications_array:
    plugin: get_classifications_array
    source: remote_product_classifications
  field_product_classifications:
    plugin: sub_process
    source: '@product_classifications_array'
    include_source: true
    process:
      vocabulary_id: vid
      target_id: target_id
  field_upc:
    -
      plugin: callback
      callable: var_dump
      source: remote_product_upc

destination:
  plugin: entity:node
migration_dependencies: {}
