# Migration configuration for cleco_products content.
id: cleco_products
label: Products
migration_group: cleco
source:
  constants:
    bool_0: 0
    bool_1: 1
    uid_root: 1
  plugin: url
  data_fetcher_plugin: file
  data_parser_plugin: simple_xml
  urls: 'public://import/pim_data/pim_export_with_schema.xml'
  namespaces:
     "http://www.stibosystems.com/step"
  item_selector: //Product[@UserTypeID="SKU Group"]
  fields:
    - name: remote_sku
      label: SKU
      selector: '@ID'
    - name: remote_name
      label: SKU Group
      selector: Name
    - name: remote_sku_group
      label: SKU Group
      selector: Values
    - name: remote_product_long_description
      label: Product Long Description
      selector: Values
    - name: remote_product_upc
      label: Product UPC
      selector: Values
    - name: remote_product_features
      label: Product Features
      selector: Values
    - name: foot_notes
      label: Product Footnotes
      selector: Values
    - name: remote_sku_overview
      label: SKU Overview
      selector: Values
    - name: product_classification_reference
      label: ClassificationReference
      selector: 'ClassificationReference[@Type="Web Reference"]'
  ids:
    remote_sku:
      type: string
process:
  type:
    plugin: default_value
    default_value: product
  title: remote_name
  sticky: constants/bool_0
  promote: constants/bool_1
  uid: constants/uid_root

  'body/value':
    plugin: apex_get_sku_group_attribute_value
    source: remote_sku_overview
    attribute: ATT17711
  'body/format':
    plugin: default_value
    default_value: basic_html
  
  field_sku: remote_sku

  field_sku_group:
    plugin: apex_get_id_attribute
    source: remote_sku_group
  
  field_long_description:
    plugin: apex_get_attribute_value
    source: remote_product_long_description
    attribute: ATT919
  
  field_upc:
    plugin: apex_get_attribute_value
    source: remote_product_upc
    attribute: ATT539

  # Copy Points
  product_features_array:
    plugin: apex_get_product_features_array
    source: remote_product_features
  field_product_features_cp:
    plugin: sub_process
    source: '@product_features_array'
    include_source: true
    process:
      value: copy_point

  'field_footnotes/value':
    plugin: apex_get_attribute_value
    source: foot_notes
    attribute: Footnotes
  'field_footnotes/format':
    plugin: default_value
    default_value: basic_html

  # Copy Points
  product_classification_reference_array:
    plugin: cleco_get_classification_reference_type_value
    source: product_classification_reference
    attribute: Web Reference
    compare_atrribute: Type
    fetch_attribute: ClassificationID
  
  field_product_classifications:
    plugin: cleco_set_taxonomy_term
    source: '@product_classification_reference_array'
    source_migration_id: cleco_product_classifications
    mutiple: 0

  language: 
    plugin: default_value
    default_value: en

destination:
  plugin: apex_product
  bundle: product
migration_dependencies:
  required:
    - cleco_product_classifications